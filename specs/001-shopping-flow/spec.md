# Feature Specification: 購物網站完整流程

**Feature Branch**: `001-shopping-flow`  
**Created**: 2025-10-25  
**Status**: Draft  
**Input**: 我們的核心目標是讓使用者有一個完整且易用的購物網站體驗，首頁可以看到熱門產品的介紹，並且產品可以依據類別區分，購物流程希望選完後可以加入購物車，最後進結帳頁面，需要保留會員的功能

**⚠️ LANGUAGE REQUIREMENT**: This specification MUST be written in Traditional Chinese (zh-TW) per constitution principle V.

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 瀏覽熱門產品 (Priority: P1)

訪客進入首頁後，能立即看到精選的熱門產品展示，快速了解本站主打商品與促銷資訊。每個產品卡片顯示產品圖片、名稱、價格與簡短描述，讓使用者能快速瀏覽並決定是否查看詳情。

**Why this priority**: 首頁是使用者進入網站的第一印象，熱門產品展示能立即吸引使用者注意力，提升轉換率。這是最基礎且能獨立運作的功能，不依賴其他系統即可展示價值。

**Independent Test**: 可透過直接訪問首頁，驗證是否正確顯示多個產品卡片，每個卡片包含完整的產品資訊（圖片、名稱、價格、描述）。即使購物車或會員功能尚未實作，此功能仍能完整呈現產品目錄的價值。

**Acceptance Scenarios**:

1. **Given** 使用者尚未登入系統，**When** 訪問首頁，**Then** 應顯示至少 8-12 個熱門產品卡片
2. **Given** 首頁已載入，**When** 使用者查看產品卡片，**Then** 每個卡片應包含產品圖片、名稱、價格與簡短描述
3. **Given** 使用者在首頁，**When** 點擊「查看詳情」按鈕，**Then** 應導航至該產品的詳細頁面
4. **Given** 產品圖片載入中，**When** 網路速度較慢，**Then** 應顯示載入動畫或佔位圖

---

### User Story 2 - 依類別瀏覽產品 (Priority: P1)

使用者可以透過類別導航快速找到感興趣的產品類型。類別採用階層式結構，支援主類別與子類別，讓使用者能精準地縮小搜尋範圍。點擊類別後進入分類頁面，顯示該類別下所有產品，並提供篩選與排序功能。

**Why this priority**: 類別瀏覽是電商網站的核心導航方式，與熱門產品展示同等重要。使用者需要透過分類快速找到目標商品，這是完成購物流程的關鍵起點。

**Independent Test**: 可透過點擊首頁的類別連結，驗證是否正確導航至分類頁面，並顯示該類別下的所有產品。即使購物車功能未完成，使用者仍能透過類別系統瀏覽完整的產品目錄。

**Acceptance Scenarios**:

1. **Given** 使用者在首頁，**When** 點擊任一產品類別，**Then** 應導航至該類別的產品列表頁面
2. **Given** 類別頁面已載入，**When** 使用者查看產品列表，**Then** 應僅顯示屬於該類別的產品
3. **Given** 類別有子類別，**When** 使用者在類別頁面，**Then** 應顯示子類別篩選選項
4. **Given** 使用者在類別頁面，**When** 選擇不同排序方式（價格高低、最新上架），**Then** 產品列表應重新排序
5. **Given** 類別頁面產品數量超過一頁，**When** 使用者滾動到頁面底部，**Then** 應自動載入更多產品或顯示分頁按鈕

---

### User Story 3 - 加入購物車 (Priority: P2)

使用者選定產品後，可以選擇數量並加入購物車。購物車保留使用者選擇的商品，讓使用者能繼續瀏覽其他產品後再一起結帳。購物車支援調整商品數量、移除商品，並即時計算總金額。

**Why this priority**: 購物車是完成交易的必要步驟，但需要先有產品展示才能發揮作用。此功能依賴 P1 的產品瀏覽功能，但本身也能獨立測試購物車的運作邏輯。

**Independent Test**: 可在產品詳情頁點擊「加入購物車」，驗證商品是否正確加入購物車，並能在購物車頁面查看、修改數量或移除商品。此功能可獨立測試而不需要結帳功能。

**Acceptance Scenarios**:

1. **Given** 使用者在產品詳情頁，**When** 選擇數量並點擊「加入購物車」，**Then** 產品應加入購物車並顯示成功訊息
2. **Given** 產品已在購物車中，**When** 再次加入相同產品，**Then** 應增加該產品的數量而非新增重複項目
3. **Given** 使用者在購物車頁面，**When** 調整商品數量，**Then** 小計與總金額應即時更新
4. **Given** 使用者在購物車頁面，**When** 點擊移除按鈕，**Then** 該商品應從購物車中移除
5. **Given** 使用者尚未登入，**When** 加入商品至購物車後關閉瀏覽器，**Then** 重新開啟時購物車內容應保留（使用瀏覽器儲存）
6. **Given** 產品庫存不足，**When** 使用者嘗試加入超過庫存數量的商品，**Then** 應顯示錯誤訊息並限制可加入的數量

---

### User Story 4 - 會員註冊與登入 (Priority: P2)

使用者可以註冊成為會員，建立個人帳號以享有更多功能。註冊時需填寫基本資料（姓名、Email、密碼、手機號碼），系統會驗證資料格式並檢查 Email 是否已被註冊。註冊完成後，使用者可使用 Email 與密碼登入系統。

**Why this priority**: 會員系統是進階功能的基礎，讓購物車資料能跨裝置同步，並支援訂單追蹤。雖然訪客也能瀏覽產品與加入購物車，但會員功能對於長期使用者體驗至關重要。

**Independent Test**: 可透過註冊新帳號並登入，驗證會員系統是否正常運作。即使結帳功能未完成，會員系統仍能獨立測試註冊、登入、登出與基本資料管理功能。

**Acceptance Scenarios**:

1. **Given** 使用者在註冊頁面，**When** 填寫完整資料並送出，**Then** 應成功建立帳號並導航至登入頁面
2. **Given** 使用者輸入已存在的 Email，**When** 嘗試註冊，**Then** 應顯示「此 Email 已被註冊」錯誤訊息
3. **Given** 使用者輸入格式不正確的 Email 或密碼，**When** 送出表單，**Then** 應顯示對應的格式錯誤提示
4. **Given** 使用者在登入頁面，**When** 輸入正確的 Email 與密碼，**Then** 應成功登入並導航至首頁
5. **Given** 使用者輸入錯誤的密碼，**When** 嘗試登入，**Then** 應顯示「帳號或密碼錯誤」訊息
6. **Given** 使用者已登入，**When** 點擊登出按鈕，**Then** 應登出帳號並清除登入狀態

---

### User Story 5 - 結帳流程 (Priority: P3)

使用者確認購物車內容後，進入結帳頁面填寫收件資訊（姓名、電話、地址）與選擇付款方式。系統會驗證資料完整性，確認庫存後建立訂單。完成訂單後顯示訂單編號與付款指示，並寄送確認信至使用者 Email。

**Why this priority**: 結帳是完整購物流程的最後一步，需要前面所有功能都完成才能發揮作用。雖然重要性高，但在開發優先順序上排在後面，因為前面的功能是其前提條件。

**Independent Test**: 可在購物車頁面點擊「前往結帳」，依序填寫收件資訊與付款方式，最後確認訂單，驗證是否成功建立訂單並顯示訂單摘要。此功能可獨立測試結帳流程，不需要實際的金流串接。

**Acceptance Scenarios**:

1. **Given** 使用者在購物車頁面，**When** 點擊「前往結帳」，**Then** 應導航至結帳頁面並顯示購物車摘要
2. **Given** 使用者是會員且已儲存地址，**When** 進入結帳頁面，**Then** 應自動帶入預設收件地址
3. **Given** 使用者在結帳頁面，**When** 填寫完整資料並選擇付款方式後點擊「確認訂單」，**Then** 應成功建立訂單並導航至訂單完成頁面
4. **Given** 使用者填寫資料不完整，**When** 嘗試送出訂單，**Then** 應顯示必填欄位錯誤提示
5. **Given** 訂單建立成功，**When** 顯示訂單完成頁面，**Then** 應包含訂單編號、付款資訊與預計送達時間
6. **Given** 商品在結帳時庫存不足，**When** 使用者送出訂單，**Then** 應顯示庫存不足錯誤並返回購物車頁面

---

### User Story 6 - 會員中心與訂單查詢 (Priority: P3)

會員登入後可進入會員中心，查看個人資料、訂單歷史記錄與管理收件地址。訂單頁面顯示所有歷史訂單，包含訂單編號、日期、狀態與總金額。點擊訂單可查看詳細內容與物流追蹤資訊。

**Why this priority**: 會員中心是提升使用者留存率的重要功能，但不影響基本的購物流程。此功能需要在會員系統與訂單系統都完成後才有意義，因此優先順序較低。

**Independent Test**: 可登入會員帳號後進入會員中心，驗證是否正確顯示個人資料與訂單列表。點擊訂單可查看完整的訂單詳情，此功能可獨立測試不需要其他新功能。

**Acceptance Scenarios**:

1. **Given** 會員已登入，**When** 點擊「會員中心」，**Then** 應顯示個人資料與功能選單
2. **Given** 會員在訂單頁面，**When** 查看訂單列表，**Then** 應顯示所有歷史訂單按時間倒序排列
3. **Given** 會員點擊某筆訂單，**When** 進入訂單詳情頁，**Then** 應顯示完整的訂單內容（商品明細、收件資訊、付款方式、訂單狀態）
4. **Given** 會員在地址管理頁面，**When** 新增或編輯地址，**Then** 應成功儲存並可在結帳時選用
5. **Given** 會員有多個收件地址，**When** 設定其中一個為預設地址，**Then** 結帳時應自動帶入該地址

---

### Edge Cases

- 當產品庫存為零時，產品卡片應顯示「已售完」標籤，且無法加入購物車
- 當使用者在購物車中的商品庫存變動時（其他使用者購買），結帳時應提示庫存不足
- 當使用者在多個瀏覽器分頁同時操作購物車時，應正確同步購物車狀態
- 當使用者網路中斷時，加入購物車的操作應暫存並在網路恢復後重試
- 當會員長時間未登入而 Session 過期時，應重新導向至登入頁面並保留原本要前往的頁面
- 當產品價格或促銷資訊變更時，已在購物車中的商品應反映最新價格
- 當使用者嘗試註冊時輸入不安全的密碼（過短或過於簡單），應顯示密碼強度提示
- 當系統同時有大量使用者結帳時，應正確處理庫存鎖定避免超賣
- 當付款閘道回應逾時時，應妥善處理並避免重複扣款

## Clarifications

### Session 2025-10-25

- Q: 購物車庫存同步策略: 當使用者將商品加入購物車後，如果該商品的庫存被其他使用者購買而減少，系統應該如何處理這個情況？ → A: 在購物車內顯示庫存警告，但允許保留直到結帳時才驗證並阻止
- Q: 訪客與會員購物車資料轉換: 當訪客在瀏覽器中已有購物車商品，然後登入或註冊成為會員時，系統應該如何處理原有的訪客購物車資料？ → A: 合併訪客購物車與會員購物車，相同商品則數量相加
- Q: 會員密碼加密演算法: 規格中提到會員密碼必須採用業界標準加密演算法，具體應該使用哪種演算法來儲存密碼？ → A: bcrypt
- Q: 登入失敗鎖定機制: 規格提到必須實作防暴力破解機制，具體的登入失敗鎖定策略應該是什麼？ → A: 5次失敗後鎖定15分鐘
- Q: 運費計算規則: 規格假設採用固定運費或免運費政策，具體應該採用哪種運費策略？ → A: 訂單滿特定金額（如NT$1000）免運費，否則固定運費NT$100

## Requirements *(mandatory)*

### Functional Requirements

#### 產品展示與瀏覽

- **FR-001**: 系統必須在首頁顯示熱門產品列表，包含產品圖片、名稱、價格與簡短描述
- **FR-002**: 系統必須提供產品類別導航，支援階層式分類結構（主類別與子類別）
- **FR-003**: 使用者必須能夠點擊類別進入分類頁面，查看該類別下的所有產品
- **FR-004**: 系統必須提供產品排序功能（價格高低、最新上架、熱門程度）
- **FR-005**: 系統必須在產品詳情頁顯示完整的產品資訊（多張圖片、詳細描述、規格、庫存狀態）
- **FR-006**: 系統必須在產品庫存為零時顯示「已售完」標示並禁用購買功能

#### 購物車管理

- **FR-007**: 使用者必須能夠將產品加入購物車並選擇數量
- **FR-008**: 系統必須在購物車中顯示所有已加入的產品，包含產品名稱、圖片、單價、數量與小計
- **FR-009**: 使用者必須能夠在購物車中調整產品數量或移除產品
- **FR-010**: 系統必須即時計算購物車總金額（商品小計、運費、折扣、總計）
- **FR-010a**: 系統必須根據訂單金額計算運費：訂單滿 NT$1000 免運費，未滿則收取固定運費 NT$100
- **FR-011**: 系統必須為訪客保留購物車內容至少 7 天（使用瀏覽器本地儲存）
- **FR-012**: 系統必須為已登入會員跨裝置同步購物車內容
- **FR-012a**: 當訪客登入或註冊成為會員時，系統必須合併訪客購物車與會員購物車，相同商品的數量需相加（不超過庫存限制）
- **FR-013**: 系統必須在使用者嘗試加入超過庫存數量的商品時顯示錯誤訊息並限制數量
- **FR-013a**: 系統必須在購物車中顯示庫存警告（當商品庫存低於購物車數量時），但允許使用者保留商品直到結帳時才進行最終庫存驗證

#### 會員系統

- **FR-014**: 系統必須提供會員註冊功能，要求填寫姓名、Email、密碼與手機號碼
- **FR-015**: 系統必須驗證 Email 格式並檢查是否已被註冊
- **FR-016**: 系統必須驗證密碼強度（至少 8 個字元，包含英文與數字）
- **FR-017**: 系統必須提供會員登入功能，支援 Email 與密碼登入
- **FR-018**: 系統必須在登入失敗時顯示明確的錯誤訊息（帳號或密碼錯誤）
- **FR-019**: 系統必須提供會員登出功能並清除登入狀態
- **FR-020**: 系統必須提供會員中心，讓會員查看與修改個人資料
- **FR-021**: 系統必須提供地址管理功能，讓會員新增、編輯、刪除與設定預設收件地址
- **FR-022**: 系統必須在 Session 過期時要求重新登入並保留原本要前往的頁面

#### 結帳流程

- **FR-023**: 系統必須提供結帳頁面，顯示購物車摘要與總金額
- **FR-024**: 系統必須要求使用者填寫收件資訊（姓名、電話、地址）
- **FR-025**: 系統必須為已登入會員自動帶入預設收件地址
- **FR-026**: 系統必須提供多種付款方式選項（信用卡、ATM 轉帳、貨到付款）
- **FR-027**: 系統必須驗證收件資訊完整性與格式正確性
- **FR-028**: 系統必須在訂單建立前檢查商品庫存並鎖定庫存
- **FR-029**: 系統必須在訂單建立成功後顯示訂單編號、付款資訊與預計送達時間
- **FR-030**: 系統必須在庫存不足時顯示錯誤訊息並阻止訂單建立
- **FR-031**: 系統必須在訂單建立成功後寄送確認信至使用者 Email

#### 訂單管理

- **FR-032**: 系統必須為會員提供訂單歷史記錄查詢功能
- **FR-033**: 系統必須顯示訂單列表，包含訂單編號、日期、狀態與總金額
- **FR-034**: 系統必須提供訂單詳情頁面，顯示完整的訂單內容（商品明細、收件資訊、付款方式、訂單狀態）
- **FR-035**: 系統必須支援訂單狀態追蹤（待付款、處理中、已出貨、配送中、已完成）

### Key Entities

- **產品（Product）**: 代表網站上販售的商品，包含產品名稱、描述、價格、圖片、庫存數量、所屬類別、規格等屬性。產品屬於某個類別，可被加入購物車或訂單中。

- **產品類別（Category）**: 代表產品的分類，採階層式結構支援主類別與子類別。包含類別名稱、描述、排序順序與父類別關聯。

- **購物車（Cart）**: 代表使用者待結帳的商品集合。對於訪客使用瀏覽器本地儲存，對於會員則儲存於伺服器並跨裝置同步。包含購物車項目清單與總金額計算。

- **購物車項目（Cart Item）**: 代表購物車中的單一產品，包含產品參照、選擇的數量、規格與加入時間。

- **會員（Member）**: 代表註冊的使用者帳號，包含姓名、Email、密碼（加密）、手機號碼、註冊日期與帳號狀態。會員可擁有多個收件地址與多筆訂單。

- **收件地址（Address）**: 代表會員儲存的收件地址資訊，包含收件人姓名、電話、城市、地區、詳細地址、郵遞區號與是否為預設地址。

- **訂單（Order）**: 代表完成的購買交易，包含訂單編號、會員參照、訂單狀態、商品小計、運費、折扣、總金額、付款方式、收件資訊、物流追蹤號碼與建立時間。訂單包含多個訂單項目。

- **訂單項目（Order Item）**: 代表訂單中的單一產品，包含產品參照、產品名稱快照、產品圖片快照、規格、購買時價格、數量與小計。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 使用者能在 3 秒內完成首頁載入並看到熱門產品列表
- **SC-002**: 使用者能在 5 次點擊內從首頁完成產品選購並加入購物車
- **SC-003**: 90% 的使用者能在首次使用時成功完成從瀏覽產品到加入購物車的流程
- **SC-004**: 使用者能在 3 分鐘內完成整個結帳流程（從購物車到訂單確認）
- **SC-005**: 會員註冊流程能在 2 分鐘內完成，包含所有必填欄位驗證
- **SC-006**: 系統能同時處理 1000 名使用者瀏覽產品而不影響效能
- **SC-007**: 購物車操作（新增、修改、刪除）的回應時間在 1 秒內
- **SC-008**: 訂單建立成功率達 95% 以上（排除使用者主動取消或庫存不足情況）
- **SC-009**: 會員登入成功後，購物車資料能在 2 秒內完成跨裝置同步
- **SC-010**: 產品圖片在 3G 網路下能在 2 秒內載入完成
- **SC-011**: 使用者在購物流程中遇到錯誤時，能看到明確的錯誤訊息與解決方法
- **SC-012**: 購物車放棄率（加入購物車但未結帳）低於 70%

## Constitution Compliance Requirements *(mandatory)*

### Documentation Language Standards (NON-NEGOTIABLE)
- **LANG-001**: 所有規格文件必須使用繁體中文（zh-TW）撰寫
- **LANG-002**: 使用者故事與驗收條件必須使用繁體中文
- **LANG-003**: UI 文字與錯誤訊息必須使用繁體中文
- **LANG-004**: 程式碼註解應盡可能使用繁體中文

### Performance Requirements
- **PERF-001**: 頁面載入時間在 3G 網路下必須 ≤2 秒
- **PERF-002**: Core Web Vitals 必須達到「良好」標準（LCP ≤2.5s, FID ≤100ms, CLS ≤0.1）
- **PERF-003**: 圖片必須採用現代格式優化並實作延遲載入
- **PERF-004**: 購物車操作（新增、修改、刪除）回應時間必須 ≤1 秒
- **PERF-005**: 系統必須支援至少 1000 名同時線上使用者而不降低效能

### Testing Requirements  
- **TEST-001**: 商業邏輯的單元測試覆蓋率必須 ≥90%
- **TEST-002**: 端對端測試必須涵蓋所有關鍵使用者流程
- **TEST-003**: 測試必須在實作前撰寫（測試驅動開發）
- **TEST-004**: 購物車與結帳流程必須有完整的整合測試
- **TEST-005**: 會員註冊與登入流程必須有安全性測試

### User Experience Requirements
- **UX-001**: 設計必須遵循既有的設計系統模式
- **UX-002**: 必須採用行動優先的響應式設計（中斷點為 768px, 1024px）
- **UX-003**: 必須符合 WCAG 2.1 AA 無障礙標準
- **UX-004**: 非同步操作必須實作載入狀態指示
- **UX-005**: 所有表單必須提供即時驗證與明確的錯誤訊息
- **UX-006**: 購物流程必須在 5 步驟內完成（瀏覽→選擇→購物車→結帳→完成）

### Security Requirements
- **SEC-001**: 所有環境必須強制使用 HTTPS
- **SEC-002**: 輸入驗證與淨化必須防止 XSS/SQL Injection 攻擊
- **SEC-003**: 付款處理必須使用符合 PCI-DSS 標準的第三方服務
- **SEC-004**: 會員密碼必須採用 bcrypt 演算法儲存（不得明文儲存）
- **SEC-005**: 登入功能必須實作防暴力破解機制（5次失敗後鎖定該帳號15分鐘）
- **SEC-006**: 敏感操作（如訂單建立）必須有 CSRF 防護
- **SEC-007**: 會員 Session 必須有合理的過期時間（建議 30 分鐘無活動後過期）

### Data Integrity Requirements
- **DATA-001**: 訂單建立前必須驗證商品庫存並實作庫存鎖定機制避免超賣
- **DATA-002**: 購物車資料必須在會員登入後正確同步而不遺失
- **DATA-003**: 訂單金額計算必須在伺服器端驗證，不可僅信任客戶端傳送的金額
- **DATA-004**: 訂單建立成功後必須寄送確認信並記錄交易日誌

## Assumptions

以下是本規格文件中基於常見電商實務所做的合理假設：

1. **產品資料管理**: 假設產品的新增、編輯與刪除功能由管理後台處理，不在本次使用者端購物流程範圍內

2. **付款處理**: 假設採用第三方金流服務整合，本系統負責訂單建立與狀態管理，實際的信用卡處理與金流串接由第三方服務處理

3. **物流追蹤**: 假設物流追蹤資訊由管理後台手動或自動更新，使用者端僅負責顯示追蹤資訊

4. **促銷與折扣**: 假設第一版不包含優惠券、折扣碼與促銷活動功能，僅顯示產品原價

5. **產品搜尋**: 假設第一版使用簡單的關鍵字搜尋，不包含進階篩選（價格區間、品牌等）功能

6. **會員驗證**: 假設註冊時不需要 Email 驗證，使用者填寫完資料即可立即使用帳號

7. **運費計算**: 採用訂單滿額免運策略：訂單金額滿 NT$1000 免運費，未滿則收取固定運費 NT$100

8. **庫存管理**: 假設庫存數量由管理後台維護，購物流程僅檢查庫存是否足夠

9. **評價系統**: 假設第一版不包含產品評價與評分功能

10. **多語系支援**: 假設第一版僅支援繁體中文，不包含多語系切換功能

11. **第三方登入**: 假設第一版不包含 Google、Facebook 等第三方社群帳號登入功能

12. **訂單取消**: 假設使用者無法自行取消訂單，需透過客服處理

13. **退貨退款**: 假設退貨退款流程不在本次購物流程範圍內，由客服系統另行處理

14. **瀏覽器支援**: 假設支援最新版本的主流瀏覽器（Chrome、Firefox、Safari、Edge）

15. **資料保留期限**: 假設訪客購物車資料保留 7 天，會員訂單資料永久保留（除非會員主動刪除帳號）
